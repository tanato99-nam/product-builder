<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-adsense-account" content="ca-pub-6372982351593840">
    <title>í—¤ì–´ìŠ¤íƒ€ì¼ ì²´í—˜ - ë‚´ ì‚¬ì§„ì— ë‹¤ì–‘í•œ í—¤ì–´ ì ìš©</title>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6372982351593840"
         crossorigin="anonymous"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');

        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Pretendard', -apple-system, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 32px 16px;
        }

        .page-header {
            text-align: center;
            margin-bottom: 28px;
        }

        .page-header h1 {
            font-size: 2rem;
            font-weight: 800;
            color: #fff;
            margin-bottom: 8px;
            text-shadow: 0 2px 12px rgba(0,0,0,0.2);
        }

        .page-header p {
            color: rgba(255,255,255,0.85);
            font-size: 1rem;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 340px;
            gap: 20px;
            max-width: 1100px;
            margin: 0 auto;
        }

        .card {
            background: #fff;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            padding: 24px;
        }

        /* Upload Area */
        .upload-area {
            border: 2.5px dashed #c4b5fd;
            border-radius: 16px;
            padding: 40px 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            background: #faf5ff;
            margin-bottom: 20px;
        }

        .upload-area:hover, .upload-area.drag-over {
            border-color: #7c3aed;
            background: #f3e8ff;
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 12px;
        }

        .upload-area h3 {
            font-size: 1.1rem;
            font-weight: 700;
            color: #5b21b6;
            margin-bottom: 6px;
        }

        .upload-area p {
            color: #8b5cf6;
            font-size: 0.88rem;
        }

        #file-input { display: none; }

        /* Canvas Area */
        .canvas-wrapper {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            background: #f8f7ff;
            border-radius: 16px;
            overflow: hidden;
            min-height: 300px;
        }

        #main-canvas {
            max-width: 100%;
            border-radius: 12px;
            display: block;
            cursor: crosshair;
        }

        .canvas-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 300px;
            color: #c4b5fd;
            gap: 12px;
        }

        .canvas-placeholder p { font-size: 0.9rem; font-weight: 600; }

        /* Controls */
        .controls-section {
            margin-top: 16px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .slider-group {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
            min-width: 180px;
        }

        .slider-group label {
            font-size: 0.8rem;
            font-weight: 600;
            color: #6b7280;
            white-space: nowrap;
            width: 52px;
        }

        input[type="range"] {
            flex: 1;
            accent-color: #7c3aed;
            height: 4px;
        }

        .slider-val {
            font-size: 0.8rem;
            color: #7c3aed;
            font-weight: 700;
            width: 34px;
            text-align: right;
        }

        .btn {
            padding: 9px 18px;
            border: none;
            border-radius: 10px;
            font-family: inherit;
            font-size: 0.88rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-secondary {
            background: #f3f4f6;
            color: #374151;
        }

        .btn-secondary:hover { background: #e5e7eb; }

        .btn-download {
            background: linear-gradient(135deg, #10b981, #059669);
            color: #fff;
            box-shadow: 0 4px 12px rgba(16,185,129,0.35);
        }

        .btn-download:hover { transform: translateY(-1px); }

        /* Sidebar */
        .sidebar-card {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .section-title {
            font-size: 0.95rem;
            font-weight: 800;
            color: #1f2937;
            margin-bottom: 14px;
        }

        /* Hairstyle Grid */
        .hairstyle-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .hairstyle-btn {
            border: 2.5px solid #e5e7eb;
            border-radius: 14px;
            padding: 10px 6px 8px;
            background: #fff;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
        }

        .hairstyle-btn:hover {
            border-color: #a78bfa;
            background: #faf5ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(124,58,237,0.15);
        }

        .hairstyle-btn.active {
            border-color: #7c3aed;
            background: #f3e8ff;
            box-shadow: 0 0 0 3px rgba(124,58,237,0.15);
        }

        .hairstyle-btn svg {
            width: 60px;
            height: 70px;
        }

        .hairstyle-btn span {
            font-size: 0.72rem;
            font-weight: 700;
            color: #6b7280;
            text-align: center;
            line-height: 1.2;
        }

        .hairstyle-btn.active span { color: #7c3aed; }

        /* Color Picker */
        .color-grid {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .color-dot {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.2s;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .color-dot:hover, .color-dot.active {
            border-color: #fff;
            outline: 3px solid #7c3aed;
            transform: scale(1.15);
        }

        /* Tips */
        .tip-box {
            background: #f0fdf4;
            border: 1.5px solid #bbf7d0;
            border-radius: 12px;
            padding: 14px;
            font-size: 0.82rem;
            color: #166534;
            line-height: 1.8;
        }

        .tip-box strong { display: block; margin-bottom: 4px; color: #15803d; }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%) translateY(80px);
            background: #1f2937;
            color: #fff;
            padding: 12px 24px;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 600;
            z-index: 9999;
            transition: transform 0.3s ease;
            pointer-events: none;
        }

        .toast.show { transform: translateX(-50%) translateY(0); }

        @media (max-width: 768px) {
            .main-layout { grid-template-columns: 1fr; }
            .hairstyle-grid { grid-template-columns: repeat(4, 1fr); }
        }

        @media (max-width: 480px) {
            .hairstyle-grid { grid-template-columns: repeat(3, 1fr); }
        }
    </style>
</head>
<body>
    <div class="page-header">
        <h1>âœ‚ï¸ í—¤ì–´ìŠ¤íƒ€ì¼ ì²´í—˜</h1>
        <p>ë‚´ ì‚¬ì§„ì— ë‹¤ì–‘í•œ í—¤ì–´ìŠ¤íƒ€ì¼ì„ ë°”ë¡œ ì ìš©í•´ë³´ì„¸ìš”</p>
    </div>

    <div class="main-layout">
        <!-- Left: Canvas Area -->
        <div class="card">
            <div class="upload-area" id="upload-area">
                <div class="upload-icon">ğŸ“¸</div>
                <h3>ì‚¬ì§„ì„ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì„¸ìš”</h3>
                <p>JPG, PNG, WEBP í˜•ì‹ ì§€ì› Â· ìµœëŒ€ 10MB</p>
                <input type="file" id="file-input" accept="image/*">
            </div>

            <div class="canvas-wrapper" id="canvas-wrapper">
                <div class="canvas-placeholder" id="canvas-placeholder">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#c4b5fd" stroke-width="1.5">
                        <rect x="3" y="3" width="18" height="18" rx="2"/>
                        <circle cx="8.5" cy="8.5" r="1.5"/>
                        <path d="M21 15l-5-5L5 21"/>
                    </svg>
                    <p>ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</p>
                </div>
                <canvas id="main-canvas" style="display:none;"></canvas>
            </div>

            <div class="controls-section" id="controls-section" style="display:none;">
                <div class="slider-group">
                    <label>í¬ê¸°</label>
                    <input type="range" id="size-slider" min="30" max="200" value="100">
                    <span class="slider-val" id="size-val">100%</span>
                </div>
                <div class="slider-group">
                    <label>ìœ„/ì•„ë˜</label>
                    <input type="range" id="y-slider" min="-100" max="100" value="0">
                    <span class="slider-val" id="y-val">0</span>
                </div>
                <div class="slider-group">
                    <label>ì¢Œ/ìš°</label>
                    <input type="range" id="x-slider" min="-100" max="100" value="0">
                    <span class="slider-val" id="x-val">0</span>
                </div>
                <button class="btn btn-secondary" id="reset-btn">ì´ˆê¸°í™”</button>
                <button class="btn btn-download" id="download-btn">ğŸ’¾ ì €ì¥</button>
            </div>
        </div>

        <!-- Right: Sidebar -->
        <div>
            <div class="card sidebar-card">
                <div>
                    <div class="section-title">ğŸ’‡ í—¤ì–´ìŠ¤íƒ€ì¼ ì„ íƒ</div>
                    <div class="hairstyle-grid" id="hairstyle-grid"></div>
                </div>

                <div>
                    <div class="section-title">ğŸ¨ ë¨¸ë¦¬ ìƒ‰ìƒ</div>
                    <div class="color-grid" id="color-grid"></div>
                </div>

                <div class="tip-box">
                    <strong>ğŸ’¡ ì‚¬ìš© ë°©ë²•</strong>
                    1. ë‚´ ì‚¬ì§„ì„ ì—…ë¡œë“œ<br>
                    2. ì›í•˜ëŠ” í—¤ì–´ìŠ¤íƒ€ì¼ ì„ íƒ<br>
                    3. í¬ê¸°Â·ìœ„ì¹˜ ìŠ¬ë¼ì´ë”ë¡œ ì¡°ì •<br>
                    4. ì €ì¥ ë²„íŠ¼ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œ
                </div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
    // â”€â”€ Hairstyle SVG definitions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const hairstyles = [
        {
            id: 'short-clean', name: 'ìˆì»· í´ë¦°',
            svg: (c) => `<svg viewBox="0 0 100 80" xmlns="http://www.w3.org/2000/svg">
                <path d="M50 8 Q20 10 16 40 Q14 58 50 60 Q86 58 84 40 Q80 10 50 8Z" fill="${c}"/>
                <path d="M16 40 Q10 30 14 20 Q20 10 50 8 Q80 10 86 20 Q90 30 84 40" fill="${c}"/>
            </svg>`
        },
        {
            id: 'wavy-long', name: 'ì›¨ì´ë¸Œ ë¡±',
            svg: (c) => `<svg viewBox="0 0 100 150" xmlns="http://www.w3.org/2000/svg">
                <path d="M50 5 Q20 8 16 35 Q12 60 18 88 Q14 100 18 115 Q22 130 28 142 Q32 150 36 140 Q28 118 30 95 Q26 68 30 40 Q34 18 50 15 Q66 18 70 40 Q74 68 70 95 Q72 118 64 140 Q68 150 72 142 Q78 130 82 115 Q86 100 82 88 Q88 60 84 35 Q80 8 50 5Z" fill="${c}"/>
            </svg>`
        },
        {
            id: 'bob', name: 'ë‹¨ë°œ (ë°¥)',
            svg: (c) => `<svg viewBox="0 0 100 110" xmlns="http://www.w3.org/2000/svg">
                <path d="M50 5 Q20 8 15 35 Q12 55 14 72 Q16 88 26 90 L26 60 Q38 64 50 64 Q62 64 74 60 L74 90 Q84 88 86 72 Q88 55 85 35 Q80 8 50 5Z" fill="${c}"/>
                <rect x="14" y="58" width="14" height="34" rx="6" fill="${c}"/>
                <rect x="72" y="58" width="14" height="34" rx="6" fill="${c}"/>
            </svg>`
        },
        {
            id: 'curly', name: 'ì»¬ë¦¬ (ê³±ìŠ¬)',
            svg: (c) => `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <circle cx="20" cy="38" r="16" fill="${c}"/>
                <circle cx="38" cy="20" r="18" fill="${c}"/>
                <circle cx="62" cy="20" r="18" fill="${c}"/>
                <circle cx="80" cy="38" r="16" fill="${c}"/>
                <circle cx="50" cy="12" r="15" fill="${c}"/>
                <ellipse cx="50" cy="54" rx="42" ry="20" fill="${c}"/>
                <circle cx="8"  cy="52" r="12" fill="${c}"/>
                <circle cx="92" cy="52" r="12" fill="${c}"/>
            </svg>`
        },
        {
            id: 'ponytail', name: 'í¬ë‹ˆí…Œì¼',
            svg: (c) => `<svg viewBox="0 0 100 160" xmlns="http://www.w3.org/2000/svg">
                <path d="M50 8 Q20 10 16 38 Q14 58 20 70 Q30 74 38 68 Q44 72 50 72 Q56 72 62 68 Q70 74 80 70 Q86 58 84 38 Q80 10 50 8Z" fill="${c}"/>
                <path d="M72 32 Q88 26 93 30 Q96 34 91 42 Q86 48 78 48 Q84 54 84 62 Q82 68 76 64 Q72 70 68 62" fill="${c}"/>
                <path d="M91 42 Q98 60 90 95 Q86 118 82 148 Q78 156 76 148 Q74 126 78 100 Q82 74 78 48" fill="${c}"/>
            </svg>`
        },
        {
            id: 'buzz', name: 'ë²„ì¦ˆì»·',
            svg: (c) => `<svg viewBox="0 0 100 70" xmlns="http://www.w3.org/2000/svg">
                <path d="M50 5 Q16 8 12 40 Q12 58 50 60 Q88 58 88 40 Q84 8 50 5Z" fill="${c}" opacity="0.7"/>
                <path d="M50 5 Q16 8 12 40 L88 40 Q84 8 50 5Z" fill="${c}"/>
            </svg>`
        },
        {
            id: 'mohawk', name: 'ëª¨íˆì¹¸',
            svg: (c) => `<svg viewBox="0 0 100 140" xmlns="http://www.w3.org/2000/svg">
                <path d="M43 92 Q39 52 41 14 Q44 4 50 3 Q56 4 59 14 Q61 52 57 92Z" fill="${c}"/>
                <path d="M41 14 Q37 4 30 7 Q23 12 27 23 Q31 32 41 32" fill="${c}"/>
                <path d="M59 14 Q63 4 70 7 Q77 12 73 23 Q69 32 59 32" fill="${c}"/>
                <ellipse cx="50" cy="90" rx="20" ry="8" fill="${c}"/>
            </svg>`
        },
        {
            id: 'side-part', name: 'ì‚¬ì´ë“œíŒŒíŠ¸',
            svg: (c) => `<svg viewBox="0 0 100 85" xmlns="http://www.w3.org/2000/svg">
                <path d="M50 6 Q18 8 14 38 Q13 56 50 58 Q87 56 86 38 Q82 8 50 6Z" fill="${c}"/>
                <path d="M14 22 Q10 12 22 8 Q34 5 42 12 Q34 20 30 32" fill="${c}"/>
                <path d="M22 8 Q34 3 44 10 Q48 5 50 6" fill="${c}" opacity="0.7"/>
            </svg>`
        },
        {
            id: 'twin-tails', name: 'ì–‘ê°ˆë˜',
            svg: (c) => `<svg viewBox="0 0 120 155" xmlns="http://www.w3.org/2000/svg">
                <path d="M60 8 Q30 10 26 38 Q24 58 30 68 Q38 72 46 66 Q52 70 60 70 Q68 70 74 66 Q82 72 90 68 Q96 58 94 38 Q90 10 60 8Z" fill="${c}"/>
                <path d="M26 50 Q10 46 6 54 Q4 64 10 74 Q6 92 8 118 Q10 140 16 150 Q20 156 22 148 Q22 128 18 106 Q16 84 22 68" fill="${c}"/>
                <path d="M94 50 Q110 46 114 54 Q116 64 110 74 Q114 92 112 118 Q110 140 104 150 Q100 156 98 148 Q98 128 102 106 Q104 84 98 68" fill="${c}"/>
            </svg>`
        },
        {
            id: 'afro', name: 'ì•„í”„ë¡œ',
            svg: (c) => `<svg viewBox="0 0 100 95" xmlns="http://www.w3.org/2000/svg">
                <circle cx="50" cy="50" r="44" fill="${c}"/>
                <circle cx="18" cy="38" r="18" fill="${c}"/>
                <circle cx="82" cy="38" r="18" fill="${c}"/>
                <circle cx="50" cy="8"  r="18" fill="${c}"/>
                <circle cx="10" cy="60" r="14" fill="${c}"/>
                <circle cx="90" cy="60" r="14" fill="${c}"/>
            </svg>`
        },
        {
            id: 'bun', name: 'ìª½ë¨¸ë¦¬ (ë²ˆ)',
            svg: (c) => `<svg viewBox="0 0 100 110" xmlns="http://www.w3.org/2000/svg">
                <path d="M50 30 Q22 32 18 56 Q16 74 50 76 Q84 74 82 56 Q78 32 50 30Z" fill="${c}"/>
                <circle cx="50" cy="18" r="18" fill="${c}"/>
                <circle cx="50" cy="7"  r="10" fill="${c}" opacity="0.75"/>
            </svg>`
        },
        {
            id: 'straight-long', name: 'ìƒë¨¸ë¦¬ ë¡±',
            svg: (c) => `<svg viewBox="0 0 100 155" xmlns="http://www.w3.org/2000/svg">
                <path d="M50 5 Q22 8 18 36 Q16 56 18 82 Q20 108 24 132 Q26 147 30 136 Q28 112 28 88 Q26 62 28 38 Q32 18 50 16 Q68 18 72 38 Q74 62 72 88 Q72 112 70 136 Q74 147 76 132 Q80 108 82 82 Q84 56 82 36 Q78 8 50 5Z" fill="${c}"/>
            </svg>`
        },
    ];

    const hairColors = [
        { name: 'ë¸”ë™',       value: '#1a0800' },
        { name: 'ë‹¤í¬ë¸Œë¼ìš´', value: '#3b1a08' },
        { name: 'ë¸Œë¼ìš´',     value: '#6b3a2a' },
        { name: 'ì¹´ë¼ë©œ',     value: '#a0522d' },
        { name: 'ê³¨ë“ ',       value: '#c8962e' },
        { name: 'í”Œë˜í‹°ë„˜',   value: '#e8dcc8' },
        { name: 'í™”ì´íŠ¸',     value: '#f5f0e8' },
        { name: 'ë”¥ë ˆë“œ',     value: '#8b1a1a' },
        { name: 'ë²„ê±´ë””',     value: '#6d2b3d' },
        { name: 'í•‘í¬',       value: '#e8638c' },
        { name: 'í¼í”Œ',       value: '#7c5cbf' },
        { name: 'ë¸”ë£¨',       value: '#2d5fa6' },
        { name: 'ê·¸ë¦°',       value: '#2d7a4f' },
        { name: 'ì‹¤ë²„',       value: '#a8a8b8' },
    ];

    // â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let currentHairstyle = null;
    let currentColor = hairColors[1].value;
    let userImage = null;
    let hairScale = 1.0;
    let hairOffsetX = 0;
    let hairOffsetY = 0;

    // â”€â”€ DOM refs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const canvas       = document.getElementById('main-canvas');
    const ctx          = canvas.getContext('2d');
    const placeholder  = document.getElementById('canvas-placeholder');
    const uploadArea   = document.getElementById('upload-area');
    const fileInput    = document.getElementById('file-input');
    const controlsSec  = document.getElementById('controls-section');
    const sizeSlider   = document.getElementById('size-slider');
    const ySlider      = document.getElementById('y-slider');
    const xSlider      = document.getElementById('x-slider');
    const sizeVal      = document.getElementById('size-val');
    const yVal         = document.getElementById('y-val');
    const xVal         = document.getElementById('x-val');
    const toastEl      = document.getElementById('toast');

    // â”€â”€ Build Hairstyle Grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const hairstyleGrid = document.getElementById('hairstyle-grid');
    hairstyles.forEach(hs => {
        const btn = document.createElement('button');
        btn.className = 'hairstyle-btn';
        btn.dataset.id = hs.id;
        btn.innerHTML = `${hs.svg(currentColor)}<span>${hs.name}</span>`;
        btn.addEventListener('click', () => selectHairstyle(hs));
        hairstyleGrid.appendChild(btn);
    });

    // â”€â”€ Build Color Grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const colorGrid = document.getElementById('color-grid');
    hairColors.forEach(c => {
        const dot = document.createElement('div');
        dot.className = 'color-dot' + (c.value === currentColor ? ' active' : '');
        dot.style.background = c.value;
        dot.title = c.name;
        dot.addEventListener('click', () => selectColor(c.value, dot));
        colorGrid.appendChild(dot);
    });

    // â”€â”€ Upload â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    uploadArea.addEventListener('click', () => fileInput.click());
    uploadArea.addEventListener('dragover', e => { e.preventDefault(); uploadArea.classList.add('drag-over'); });
    uploadArea.addEventListener('dragleave', () => uploadArea.classList.remove('drag-over'));
    uploadArea.addEventListener('drop', e => {
        e.preventDefault();
        uploadArea.classList.remove('drag-over');
        const file = e.dataTransfer.files[0];
        if (file && file.type.startsWith('image/')) loadImage(file);
    });
    fileInput.addEventListener('change', e => {
        if (e.target.files[0]) loadImage(e.target.files[0]);
    });

    function loadImage(file) {
        const reader = new FileReader();
        reader.onload = ev => {
            const img = new Image();
            img.onload = () => {
                userImage = img;
                const maxW = Math.min(680, img.width);
                const ratio = maxW / img.width;
                canvas.width  = maxW;
                canvas.height = img.height * ratio;

                placeholder.style.display = 'none';
                canvas.style.display = 'block';
                controlsSec.style.display = 'flex';

                hairOffsetX = 0; hairOffsetY = 0;
                sizeSlider.value = 100; ySlider.value = 0; xSlider.value = 0;
                updateSliderLabels();
                render();
                showToast('ì‚¬ì§„ì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤! í—¤ì–´ìŠ¤íƒ€ì¼ì„ ì„ íƒí•˜ì„¸ìš”.');
            };
            img.src = ev.target.result;
        };
        reader.readAsDataURL(file);
    }

    // â”€â”€ Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function render() {
        if (!userImage) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(userImage, 0, 0, canvas.width, canvas.height);
        if (!currentHairstyle) return;

        const svgStr  = currentHairstyle.svg(currentColor);
        const blob    = new Blob([svgStr], { type: 'image/svg+xml;charset=utf-8' });
        const url     = URL.createObjectURL(blob);
        const hairImg = new Image();

        hairImg.onload = () => {
            const baseW = canvas.width * 0.72 * hairScale;
            const aspect = hairImg.naturalHeight / hairImg.naturalWidth;
            const hairW = baseW;
            const hairH = baseW * aspect;
            const x = (canvas.width  - hairW) / 2 + hairOffsetX;
            const y = -hairH * 0.28 + hairOffsetY;

            ctx.drawImage(hairImg, x, y, hairW, hairH);
            URL.revokeObjectURL(url);
        };
        hairImg.src = url;
    }

    // â”€â”€ Select Hairstyle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function selectHairstyle(hs) {
        currentHairstyle = hs;
        document.querySelectorAll('.hairstyle-btn').forEach(b => b.classList.remove('active'));
        document.querySelector(`[data-id="${hs.id}"]`).classList.add('active');
        render();
    }

    // â”€â”€ Select Color â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function selectColor(val, dotEl) {
        currentColor = val;
        document.querySelectorAll('.color-dot').forEach(d => d.classList.remove('active'));
        dotEl.classList.add('active');
        // Refresh SVG previews in hairstyle buttons
        hairstyles.forEach(hs => {
            const btn = document.querySelector(`[data-id="${hs.id}"]`);
            if (btn) btn.innerHTML = `${hs.svg(currentColor)}<span>${hs.name}</span>`;
        });
        render();
    }

    // â”€â”€ Sliders â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function updateSliderLabels() {
        sizeVal.textContent = sizeSlider.value + '%';
        yVal.textContent    = ySlider.value;
        xVal.textContent    = xSlider.value;
    }

    sizeSlider.addEventListener('input', () => {
        hairScale = parseInt(sizeSlider.value) / 100;
        updateSliderLabels(); render();
    });
    ySlider.addEventListener('input', () => {
        hairOffsetY = parseInt(ySlider.value) * (canvas.height / 100);
        updateSliderLabels(); render();
    });
    xSlider.addEventListener('input', () => {
        hairOffsetX = parseInt(xSlider.value) * (canvas.width / 100);
        updateSliderLabels(); render();
    });

    document.getElementById('reset-btn').addEventListener('click', () => {
        hairOffsetX = 0; hairOffsetY = 0; hairScale = 1.0;
        sizeSlider.value = 100; ySlider.value = 0; xSlider.value = 0;
        updateSliderLabels(); render();
    });

    // â”€â”€ Download â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    document.getElementById('download-btn').addEventListener('click', () => {
        canvas.toBlob(blob => {
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'hairstyle-result.png';
            a.click();
            URL.revokeObjectURL(a.href);
            showToast('ì´ë¯¸ì§€ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }, 'image/png');
    });

    // â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let toastTimer;
    function showToast(msg) {
        toastEl.textContent = msg;
        toastEl.classList.add('show');
        clearTimeout(toastTimer);
        toastTimer = setTimeout(() => toastEl.classList.remove('show'), 2800);
    }
    </script>
</body>
</html>
